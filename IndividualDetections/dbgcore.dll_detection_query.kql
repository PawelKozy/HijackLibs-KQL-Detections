DeviceImageLoadEvents
| extend FileName = tolower(FileName), FolderPath = tolower(FolderPath), InitiatingProcessFileName = tolower(InitiatingProcessFileName)
| where Filename == "dbgcore.dll"
| where not(FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\arm" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\arm\\srcsrv" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\arm64" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\arm64\\srcsrv" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\x64" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\x64\\srcsrv" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\x86" or FolderPath contains "c:\\program files\\windows kits\\10\\debuggers\\x86\\srcsrv" or FolderPath contains "c:\\program files\\microsoft office\\root\\office" or FolderPath contains "c:\\windows\\system32" or FolderPath contains "c:\\windows\\syswow64") and (InitiatingProcessFileName endswith "deploymentcsphelper.exe" or InitiatingProcessFileName endswith "djoin.exe" or InitiatingProcessFileName endswith "dnscacheugc.exe" or InitiatingProcessFileName endswith "ieunatt.exe" or InitiatingProcessFileName endswith "muiunattend.exe" or InitiatingProcessFileName endswith "netbtugc.exe" or InitiatingProcessFileName endswith "netiougc.exe" or InitiatingProcessFileName endswith "pnpunattend.exe" or InitiatingProcessFileName endswith "setupugc.exe" or InitiatingProcessFileName endswith "systemreset.exe" or InitiatingProcessFileName endswith "werfault.exe" or InitiatingProcessFileName endswith "werfaultsecure.exe")
| invoke FileProfile("SHA1", 1000)
